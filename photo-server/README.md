# Photo Server

Серверное приложение, разработанное на NestJS, для приёма и сохранения фотографий. Сервер проверяет целостность фотографий с помощью сравнения хеш-сумм SHA-256 и сохраняет их эффективно, логируя важные события.

## Содержание

- [Особенности](#особенности)
- [Требования](#требования)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Запуск приложения](#запуск-приложения)
- [Документация API](#документация-api)
  - [Загрузка фотографии](#загрузка-фотографии)
- [Логирование](#логирование)

## Особенности

- Принимает загрузку фотографий через HTTP POST запросы.
- Проверяет целостность фотографий с помощью сравнения хеш-сумм SHA-256.
- Сохраняет фотографии на диск, организуя их по дате.
- Обеспечивает уникальность имён файлов для предотвращения перезаписи.
- Логирует события, предупреждения и ошибки с помощью Winston.
- Настраивается через переменные окружения.

## Требования

- [Node.js](https://nodejs.org/) (рекомендуется LTS версия, например, v18.x)
- [npm](https://www.npmjs.com/) (поставляется вместе с Node.js)
- [Git](https://git-scm.com/)

## Установка

1. **Клонируйте репозиторий:**

   ```
   bash
   git clone https://github.com/Denis412/photo-server.git
   cd photo-server
   ```

2. **Создание .env файла**

```
# Порт сервера
PORT=3000

# Путь для сохранения фотографий
PHOTO_SAVE_PATH=./uploads/photos
```

3. **Запуск приложения**

```
suso chmod +x ./start.sh
sh ./start.sh
```

## Документация API

### Загрузка фотографии

**Эндпоинт:**

```
POST /photos/upload
```

**Описание:**

Загружает фотографию на сервер. Сервер проверяет целостность фотографии, сравнивая предоставленную клиентом хеш-сумму SHA-256 с вычисленной на сервере.

**Заголовки:**

- `Content-Type: multipart/form-data`

**Параметры формы:**

- `photo` (file, обязательный): Файл фотографии для загрузки.
- `hash` (string, обязательный): Хеш-сумма SHA-256 файла фотографии, вычисленная на стороне клиента.

**Ответ:**

- **Успех (HTTP 201 Created):**

  ```json
  {
    "message": "Фото успешно сохранено",
    "filename": "uuid-photo.jpg"
  }
  ```

  - `message`: Сообщение об успешной загрузке.
  - `filename`: Уникальное имя файла, под которым фотография была сохранена.

- **Ошибки:**

  - **HTTP 400 Bad Request:**

    - Отсутствует параметр `hash`.
    - Несовпадение хеш-сумм, указывающее на повреждение данных.
    - Недопустимый тип файла (принимаются только JPEG).

  ```json
  {
    "statusCode": 400,
    "message": "Хеш-сумма не предоставлена",
    "error": "Bad Request"
  }
  ```

  ```json
  {
    "statusCode": 400,
    "message": "Данные повреждены: хеш-суммы не совпадают",
    "error": "Bad Request"
  }
  ```

  ```json
  {
    "statusCode": 400,
    "message": "Недопустимый тип файла",
    "error": "Bad Request"
  }
  ```

**Пример запроса с использованием `curl`:**

```bash
curl -X POST http://localhost:3000/photos/upload \
  -F "photo=@/path/to/photo.jpg" \
  -F "hash=хеш_сумма"
```

## Логирование

Сервер использует Winston для логирования. Логи пишутся в файл `./app.log`.

- **Информационные логи:** Общая информация о запуске сервера и загрузке фотографий.
- **Предупреждения:** Ситуации, такие как превышение допустимого времени сохранения файла (>50 мс) или несовпадение хеш-сумм.
- **Ошибки:** Ошибки, возникшие при сохранении или обработке файлов.

Конфигурацию логирования можно настроить в `main.ts` и в сервисах.
